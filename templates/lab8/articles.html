{% extends "base.html" %}
{% block lab %}Статьи{% endblock %}
{% block main %}
    <h1>{% if current_user.is_authenticated %}Мои и публичные статьи{% else %}Публичные статьи{% endif %}</h1>

    {% if current_user.is_authenticated %}
        <p><a href="/lab8/create/">Создать новую статью</a></p>
    {% endif %}

    {% if articles %}
        {% for article in articles %}
            <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                <h3>{{ article.title }}</h3>

                <!-- Показываем статус статьи -->
                <div style="margin-bottom: 10px;">
                    {% if article.is_public %}
                        <span style="color: green; font-weight: bold;">✓ Публичная</span>
                    {% else %}
                        <span style="color: gray;">Приватная</span>
                    {% endif %}

                    {% if article.login_id == current_user.id %}
                        <span style="color: blue; margin-left: 10px;">(Моя статья)</span>
                    {% endif %}
                </div>

                <p>{{ article.article_text[:200] }}{% if article.article_text|length > 200 %}...{% endif %}</p>

                <!-- Кнопки управления показываем только для своих статей -->
                {% if current_user.is_authenticated and article.login_id == current_user.id %}
                    <p>
                        <a href="/lab8/articles/{{ article.id }}/edit/">Редактировать</a>
                        <form action="/lab8/articles/{{ article.id }}/delete/" method="post" style="display: inline;">
                            <button type="submit" onclick="return confirm('Вы уверены, что хотите удалить эту статью?')">Удалить</button>
                        </form>
                    </p>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p>{% if current_user.is_authenticated %}У вас пока нет статей, и нет публичных статей других пользователей.{% else %}Нет публичных статей.{% endif %}</p>
    {% endif %}
{% endblock %}
